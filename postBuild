#!/bin/bash
set -euxo pipefail

# Core pieces for your notebook + backend proxy
pip install --no-cache-dir -q \
  ipywidgets \
  jupyterlab_widgets \
  jupyter-server-proxy \
  fastapi \
  "uvicorn[standard]"

# Optional: enable legacy widgets only if the command exists (older images)
if jupyter nbextension list >/dev/null 2>&1; then
  jupyter nbextension enable --py widgetsnbextension --sys-prefix || true
fi

# Install the autostart script so the kernel starts your backend automatically
mkdir -p "${HOME}/.ipython/profile_default/startup"
cp -f binder_autostart.py "${HOME}/.ipython/profile_default/startup/00-qsim-autostart.py"

# Debug info (handy in build logs)
python --version
jupyter --version
